<!doctype html>
<html lang="pt-br">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
     <meta name="description" content="development front end page for zeneconomics control of life tool ">
    <meta name="author" content="Carlos cesar da Silva Ferraz Junior">
    <link rel="icon" href="images/favicon.ico">

    <script src="javascript/jquery-3.3.1.min.js"></script>
    <script src="javascript/popper.min.js"></script>
    <script src="javascript/bootstrap-4.1.3-dist/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.min.js"></script>

    <!-- Icons -->
    <script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script>


    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="javascript/bootstrap-4.1.3-dist/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <!--<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">-->
     <!-- Custom styles for this template -->
    <link href="stylesheets/dashboard.css" rel="stylesheet">
    <link href="stylesheets/resources.css" rel="stylesheet">

    <script>
      var sessionId = "<%=sessionId%>";
      var userId = "<%=session.userId%>";
      var chartData=[];
      <%if(target=="summary"){%>

      var resourcesLayout = {};
      resourcesLayout.dinheiro={color:"#<%=resourcesLayoutData.money.color%>",logo:"<%=session.resourcesLayoutData.money.logo%>"};
      resourcesLayout.conhecimento={color:"#<%=resourcesLayoutData.knowledge.color%>",logo:"<%=resourcesLayoutData.knowledge.logo%>"};
      resourcesLayout.tempo={color:"#<%=resourcesLayoutData.time.color%>",logo:"<%=resourcesLayoutData.time.logo%>"};
      resourcesLayout.emoção={color:"#<%=resourcesLayoutData.emotion.color%>",logo:"<%=resourcesLayoutData.emotion.logo%>"};
      resourcesLayout.saúde={color:"#<%=resourcesLayoutData.health.color%>",logo:"<%=resourcesLayoutData.health.logo%>"};
      <%}%>
    </script>

    <title>Controle da Vida - Zen Economics - Dev</title>

  </head>

 <body>

    <!-- Modal -->
    <div class="modal fade" id="modalCannotSaveQuestionaire" tabindex="-1" role="dialog" aria-labelledby="cannotSaveQuestionaire" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Salvar Questionário</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true"></span>
            </button>
          </div>
          <div class="modal-body">

          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <!--<button type="button" class="btn btn-primary">Save changes</button>-->
          </div>
        </div>
      </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="modalLogoutConfirmation" tabindex="-1" role="dialog" aria-labelledby="logout" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Logout</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true"></span>
            </button>
          </div>
          <div class="modal-body">
            Você irá encerrar a sua sessão. Os dados de seu questionário estão gravados com segurança. Tem certeza de que quer fazer isso?
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
            <button type="button" class="btn btn-primary" id="closeSession">Encerrar sessão</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="modalSaveUserQuestionaireConfirmation" tabindex="-1" role="dialog" aria-labelledby="logout" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Gravação de Formulário</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true"></span>
            </button>
          </div>
          <div class="modal-body">
            O seu formulário completo foi gravado com sucesso e os resultados podem ser visualizados em seu gráfico de evolução, mas ele não poderá ser mais modificado.
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Ok</button>
            <!--<button type="button" class="btn btn-primary" id="closeSession">Encerrar sessão</button>-->
          </div>
        </div>
      </div>
    </div>

     <!-- Modal -->
    <div class="modal fade" id="modalSaveUserQuestionaireError" tabindex="-1" role="dialog" aria-labelledby="logout" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Gravação de Formulário</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true"></span>
            </button>
          </div>
          <div class="modal-body">
            O seu formulário completo não pode ser gravado. Tente novamente.
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Ok</button>
            <!--<button type="button" class="btn btn-primary" id="closeSession">Encerrar sessão</button>-->
          </div>
        </div>
      </div>
    </div>

    <nav class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0">
      <a class="navbar-brand col-sm-3 col-md-2 mr-0" href="#">Zen Economics-BETA</a>
      <input class="form-control form-control-dark w-100" type="text" placeholder="procurar" aria-label="Procurar">
      <ul class="navbar-nav px-3">
        <li class="nav-item text-nowrap">
          <a class="nav-link" href="" id="buttonLogout">Sair</a>
        </li>
      </ul>
    </nav>



    <div class="container-fluid">
      <div class="row">

        <nav class="col-md-2 d-none d-md-block bg-light sidebar">
          <div class="sidebar-sticky">
            <ul class="nav flex-column">
              <li class="nav-item">
                <a class="nav-link <%if(target=="home"){%>active<%}%>" href="/home">
                  <span data-feather="home"></span>
                  Sua Evolução<span class="sr-only"><%if(target=="home"){%>(atual)<%}%></span>
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link <%if(target=="summary"){%>active<%}%>" href="/summary">
                  <span data-feather="paperclip"><%if(target=="summary"){%>(atual)<%}%></span>
                  Resumo dos Recursos
                </a>
              </li>
              <!--
              <li class="nav-item">
                <a class="nav-link <%if(target=="recommendation"){%>active<%}%>" href="/#">
                  <span data-feather="dollar-sign"><%if(target=="recommendations"){%>(atual)<%}%></span>
                  Recomendações
                </a>
              </li>
            -->
              <hr>
              <li class="nav-item">
                <div class="alert alert-danger" role="alert" id="questionaireSaveStatusProblem" style='display:none;'>
                  Problemas ao gravar o questionário
                </div>
                <div class="alert alert-success" role="alert" id="questionaireSaveStatusSuccess" style='display:none;'>
                  Questionário gravado com sucesso
                </div>
                <div class="alert alert-info" role="alert" id="questionaireSaveStatusSaving" style='display:none;'>
                  gravando...
                </div>
              </li>
              <li class="nav-item">
                <a class="nav-link <%if(target=="money"){%>active<%}%>" href="/money">
                  <span data-feather="dollar-sign"><%if(target=="money"){%>(atual)<%}%></span>
                  Dinheiro
                  <span class="moneyPercentual"></span>
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link <%if(target=="health"){%>active<%}%>" href="/health">
                  <span data-feather="heart"><%if(target=="health"){%>(atual)<%}%></span>
                  Saúde
                  <span class="healthPercentual"></span>
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link <%if(target=="knowledge"){%>active<%}%>" href="/knowledge">
                  <span data-feather="book"><%if(target=="knowledge"){%>(atual)<%}%></span>
                  Conhecimento
                  <span class="knowledgePercentual"></span>
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link <%if(target=="time"){%>active<%}%>" href="/time">
                  <span data-feather="watch"><%if(target=="time"){%>(atual)<%}%></span>
                  Tempo
                  <span class="timePercentual"></span>
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link <%if(target=="emotion"){%>active<%}%>" href="/emotion">
                  <span data-feather="activity"><%if(target=="emotion"){%>(atual)<%}%></span>
                  Emoção
                  <span class="emotionPercentual"></span>
                </a>
              </li>
            </ul>

            <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
              <span>Relatórios Gravados</span>
              <a class="d-flex align-items-center text-muted" href="#">
                <span data-feather="plus-circle"></span>
              </a>
            </h6>
            <ul class="nav flex-column mb-2">
              <li class="nav-item">
                <a class="nav-link" href="#">
                  <span data-feather="file-text"></span>
                   Este ano
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">
                  <span data-feather="file-text"></span>
                  Simulador
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">
                  <span data-feather="file-text"></span>
                  Projeção
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">
                  <span data-feather="file-text"></span>
                  Evolução
                </a>
              </li>
            </ul>
            <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
              <span>Administrativo</span>
              <a class="d-flex align-items-center text-muted" href="#">
                <span data-feather="plus-circle"></span>
              </a>
            </h6>
            <ul class="nav flex-column mb-2">
              <li class="nav-item">
                <a class="nav-link" href="#">
                  <span data-feather="file-text"></span>
                   Recomendações
                </a>
              </li>
            </ul>
          </div>
        </nav>

        <!----------------------------- HOME WRAP ------------------------------>
        <%if(target=='home'){%>
        <main role="main" class="col-md-9 ml-sm-auto col-lg-10 pt-3 px-4">
          <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom">
            <h1 class="h2">Painel de <%=session.userName%></h1>
            <div class="btn-toolbar mb-2 mb-md-0">
              <div class="btn-group mr-2">
                <button class="btn btn-sm btn-outline-secondary">Compartilhar</button>
                <button class="btn btn-sm btn-outline-secondary">Exportar</button>
              </div>
              <button class="btn btn-sm btn-outline-secondary dropdown-toggle">
                <span data-feather="calendar"></span>
                Este ano
              </button>
            </div>
          </div>

          <canvas class="my-4" id="myChart" width="900" height="380"></canvas>

          <h2>Resultados</h2>
          <div class="table-responsive">
            <table class="table table-striped table-sm" id="resultsTable">
              <thead>
                <tr>
                  <th>Data</th>
                  <th>Média</th>
                  <th>Dinheiro</th>
                  <th>Saúde</th>
                  <th>Conhecimento</th>
                  <th>Tempo</th>
                  <th>Emoção</th>
                </tr>
              </thead>
              <tbody>

              </tbody>
            </table>
          </div>
        </main>
        <%}%>
        <!-- --------------------------- END OF HOME WRAP ------------------------------>
        <!-- ----------------------------- SUMMARY WRAP -------------------------------->
        <%if(target=='summary'){


        %>
        <main role="main" class="col-md-9 ml-sm-auto col-lg-10 pt-3 px-4">
          <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom">
            <h1 class="h2">Resumo de <%=session.userName%></h1>
            <div class="btn-toolbar mb-2 mb-md-0">
              <div class="btn-group mr-2">
                <button class="btn btn-sm btn-outline-secondary">Compartilhar</button>
                <button class="btn btn-sm btn-outline-secondary">Exportar</button>
              </div>
              <button class="btn btn-sm btn-outline-secondary dropdown-toggle">
                <span data-feather="calendar"></span>
                Este ano
              </button>
            </div>
          </div>

          <canvas class="my-4" id="summaryChart" style="width:900px;height:300px;"></canvas>

          <h2>Resultados dos recursos do último questionário completo</h2>

          <script>
          var chartLables = [];
          var chartData = [];
          var chartBackgroundColors = [];
          var chartBorderColors = [];

          </script>

          <%
          // build tables for each resource and subresource

          if(userQuestionaire.length>0){

          var lastCompleteUserQuestionaire=session.lastCompleteUserQuestionaire;
          var resources = lastCompleteUserQuestionaire[0].resources;

          var resourcesArray = {};

          for(var r in resources){

            resourcesArray[r]={};
            var subresources = resources[r];
            resourcesArray[r].resourceAverage = 0;
            resourcesArray[r].o_que_fazer = [];
            var resourceSum = 0;
            var resourceCount = 0;
            resourcesArray[r].subresources={};

            for(var s in subresources){
              resourcesArray[r].subresources[s]={};
              var topics = subresources[s];
              resourcesArray[r].subresources[s].subresourceAverage = 0;
              resourcesArray[r].subresources[s].topics = {};

              resourcesArray[r].subresources[s].topics.o_que_evitar = [];
              for(var top=0;top<topics.o_que_evitar.length;top++){
                resourcesArray[r].subresources[s].topics.o_que_evitar.push(topics.o_que_evitar[top].option);
              }

              var questionaireSum = 0;
              var questionaireCount = 0;

              for(var q in topics.questionaire){
                  questionaireCount ++;
                  questionaireSum  += +topics.questionaire[q].score;
              }

                for(var q in topics.free_questionaire){
                  questionaireCount ++;
                  questionaireSum  += (+topics.free_questionaire[q].answerOrder)*2;
              }

              var subresourceAverage = +(questionaireSum / questionaireCount);
              resourceCount ++;
              resourceSum += +subresourceAverage;

              resourcesArray[r].o_que_fazer.push(
                {topic:topics.o_que_fazer[0].option,subresourceAverage:subresourceAverage}
              );

              resourcesArray[r].subresources[s].subresourceAverage = subresourceAverage;

            }
            var resourceAverage = (+resourceSum/+resourceCount)
            resourcesArray[r].resourceAverage = resourceAverage;
            %>
            <script>
              //chartData.push(['<%=r%>',<%=resourceAverage%>, resourcesLayout.<%=r%>.color]);
              chartLables.push('<%=r%>');
              chartData.push(<%=resourceAverage%>);
              chartBackgroundColors.push(resourcesLayout.<%=r%>.color);
              chartBorderColors.push(resourcesLayout.<%=r%>.color);
            </script>
            <%

          }

          %>

          <div class="container">
            <div class="row w-100">
            <%
              for(var r in resourcesArray){
                %>
                <div class="col-12"><!-- resource column -->

                  <div class="row">
                    <div class="col text-uppercase border rounded bg-dark text-white text-center text-weight-bold h1">
                       <%=r%> - média: <%=resourcesArray[r].resourceAverage.toFixed(2)%>
                    </div>
                  </div>

                  <%
                    var subresources = resourcesArray[r].subresources;

                    for(var sub in subresources){
                  %>
                    <div class="row">
                      <div class="col text-uppercase text-center border rounded bg-light"><%=sub%></div>
                      <div class="col text-uppercase text-center border rounded bg-light"><%=subresources[sub].subresourceAverage.toFixed(2)%></div>
                    </div>
                  <%
                    }//for(var sub in subresources)

                    var subresources = resourcesArray[r].subresources;

                    %>
                    <div class="row">
                      <div class="col text-center text-uppercase border rounded text-weight-bold bg-danger text-white h2">O QUE EVITAR</div>
                    </div><!-- class="row">-->
                    <%
                    for(var sub in subresources){
                      topics = subresources[sub].topics.o_que_evitar;


                        %>
                          <div class="row">
                            <div class="col text-uppercase text-center border rounded bg-light"><%=topics[0]%></div>
                          </div>
                        <%

                    }//for(var sub in subresources)
                    %>

                    <div class="row">
                      <div class="col text-center text-uppercase border rounded text-weight-bold bg-success text-white h2">O QUE FAZER</div>
                    </div><!-- class="row">-->
                    <%
                    var o_que_fazer_topics = resourcesArray[r].o_que_fazer;
                    o_que_fazer_topics.sort(function(a,b){
                      if(a.subresourceAverage < b.subresourceAverage)
                        return -1;
                      if(a.subresourceAverage > b.subresourceAverage)
                        return 1;
                      return 0;
                    });


                    for(var o=o_que_fazer_topics.length-2;o<o_que_fazer_topics.length;o++){

                        %>
                          <div class="row">
                            <div class="col text-uppercase text-center border rounded bg-light"><%=o_que_fazer_topics[o].topic%></div>
                          </div>
                        <%

                    }

                    %>


                </div><!-- end of resource column -->
            <%
              }//for(var r in resourcesArray)
            %>
            </div><!-- all resources row column -->
          </div><!-- container -->

        <script>

        var ctx = document.getElementById("summaryChart");
         var summaryChart = new Chart(ctx, {
           type: 'bar',
           data: {
             labels: chartLables,
             datasets: [{
               data: chartData,
               lineTension: 0,
               fill:true,
               backgroundColor: chartBackgroundColors,
               borderColor: chartBorderColors,
               borderWidth: 1,
               pointBackgroundColor: '#007bff'
             }]
           },
           options: {
             scales: {
               yAxes: [{
                 ticks: {
                   beginAtZero: true
                 }
               }]
             },
             legend: {
               display: false
             }
           }
         });
        </script>
        <%
        } else {

        %>

        <div class="container">
          <div class="h1">Não existem questionários completos para este usuário</div>
        </div>

        <%

        }
        %>

        </main>
        <%}%>
        <!----------------------------- END OF SUMMARY WRAP ------------------------------>

        <%if(target=="money" || target=="time" || target=="knowledge" || target=="health" || target=="emotion" ){%>
        <!----------------------------- <%=target%> WRAP ------------------------------------->
        <form id="resourcesForm">
        <%
          var resources = questionaireTemplate.resources;
          var subresources;
          var resourceName;
          for(rindex=0;rindex<resources.length;rindex++){
            resourceName = (resources[rindex].name).toLowerCase();

            var visible = false;

            if( (resourceName=="dinheiro" && target=="money") || (resourceName=="tempo" && target=="time") || (resourceName=="conhecimento" && target=="knowledge") || (resourceName=="saúde" && target=="health") || (resourceName=="emoção" && target=="emotion") ){
              visible = true;
            }


        %>

            <main role="main" resource="<%=resourceName%>" class="col-md-9 ml-sm-auto col-lg-10 pt-3 px-4" <%if(!visible){%>style="display:none;"<%}%>>
              <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom">
                <h1 class="h2"><%=resourceName%> de <%=session.userName%></h1>
                <div class="btn-toolbar mb-2 mb-md-0">
                  <div class="btn-group mr-2">
                    <button class="btn btn-sm btn-outline-secondary">Compartilhar</button>
                    <button class="btn btn-sm btn-outline-secondary" id="saveCompleteQuestionaire" data-toggle="modal" data-target="#modalCannotSaveQuestionaire"></button>
                  </div>

                </div>

              </div>

              <div id="error_message"></div>

            <%
            subresources = resources[rindex].subresources;

            for(sindex=0;sindex<subresources.length;sindex++){

              var subresourceName = (subresources[sindex].name).toLowerCase();

            %>
                <h2 class="what-to-avoid">O que evitar - <%=subresourceName%></h2>
                  <div class="row">
                    <div class="input-group mb-3">
                      <div class="input-group-prepend">
                        <label class="input-group-text toavoid" for="inputGroupSelect01">01</label>
                      </div>
                      <select class="custom-select" resource="<%=resourceName%>" subresource="<%=subresourceName%>" topic="o_que_evitar" order="1">
                        <option value="" selected>escolha o que evitar</option>
                        <%if(subresources[sindex].o_que_evitar.length>0){
                          var o_que_evitar = subresources[sindex].o_que_evitar;
                          for(j=0;j<o_que_evitar.length;j++){
                            %>
                            <option value='<%=j+1%>'><%=o_que_evitar[j].option%></option>
                            <%
                          }
                        }%>
                      </select>
                    </div>
                  </div><!--row-->
                  <div class="row">
                    <div class="input-group mb-3">
                      <div class="input-group-prepend">
                        <label class="input-group-text toavoid" for="inputGroupSelect02">02</label>
                      </div>
                      <select class="custom-select" resource="<%=resourceName%>" subresource="<%=subresourceName%>" topic="o_que_evitar" order="2">
                        <option value="" selected>escolha o que evitar</option>
                        <%if(subresources[sindex].o_que_evitar.length>0){
                          var o_que_evitar = subresources[sindex].o_que_evitar;
                          for(j=0;j<o_que_evitar.length;j++){
                            %>
                            <option value='<%=j+1%>'><%=o_que_evitar[j].option%></option>
                            <%
                          }
                        }%>
                      </select>
                    </div>
                  </div><!--row-->
                  <div class="row">
                    <div class="input-group mb-3">
                      <div class="input-group-prepend">
                        <label class="input-group-text toavoid" for="inputGroupSelect03">03</label>
                      </div>
                      <select class="custom-select" resource="<%=resourceName%>" subresource="<%=subresourceName%>" topic="o_que_evitar" order="3">
                        <option value="" selected>escolha o que evitar</option>
                        <%if(subresources[sindex].o_que_evitar.length>0){
                          var o_que_evitar = subresources[sindex].o_que_evitar;
                          for(j=0;j<o_que_evitar.length;j++){
                            %>
                            <option value='<%=j+1%>'><%=o_que_evitar[j].option%></option>
                            <%
                          }
                        }%>
                      </select>
                    </div>
                  </div><!--row-->
                  <div class='row'>
                    <div class="input-group mb-3">
                      <div class="input-group-prepend">
                        <span class="input-group-text toavoid" id="basic-addon4">04</span>
                      </div>
                      <input type="text" class="form-control" placeholder="escreva o que evitar" aria-label="o que evitar" aria-describedby="basic-addon1" resource="<%=resourceName%>" subresource="<%=subresourceName%>" topic="o_que_evitar_free" order="1">
                    </div>
                  </div>

                  <div class='row'>
                    <div class="input-group mb-3">
                      <div class="input-group-prepend">
                        <span class="input-group-text toavoid" id="basic-addon5">05</span>
                      </div>
                      <input type="text" class="form-control" placeholder="escreva o que evitar" aria-label="o que evitar" aria-describedby="basic-addon1" resource="<%=resourceName%>" subresource="<%=subresourceName%>" topic="o_que_evitar_free" order="2">
                    </div>
                  </div>

                  <div class='row'>
                    <div class="input-group mb-3">
                      <div class="input-group-prepend">
                        <span class="input-group-text toavoid" id="basic-addon6">06</span>
                      </div>
                      <input type="text" class="form-control" placeholder="escreva o que evitar" aria-label="o que evitar" aria-describedby="basic-addon1" resource="<%=resourceName%>" subresource="<%=subresourceName%>" topic="o_que_evitar_free" order="3">
                    </div>
                  </div>
                  <!-- end of h2 what to avoid -->

                <h2 class="what-to-do">O que fazer - <%=subresources[sindex].name%></h2>
                  <div class="row">
                    <div class="input-group mb-3">
                      <div class="input-group-prepend">
                        <label class="input-group-text todo" for="inputGroupSelect01">01</label>
                      </div>
                      <select class="custom-select" resource="<%=resourceName%>" subresource="<%=subresourceName%>" topic="o_que_fazer" order="1">
                        <option value="" selected>escolha o que fazer</option>
                        <%if(subresources[sindex].o_que_fazer.length>0){
                          var o_que_fazer = subresources[sindex].o_que_fazer;
                          for(j=0;j<o_que_fazer.length;j++){
                            %>
                            <option value='<%=j+1%>'><%=o_que_fazer[j].option%></option>
                            <%
                          }
                        }%>
                      </select>
                    </div>
                  </div><!--row-->
                 <div class="row">
                    <div class="input-group mb-3">
                      <div class="input-group-prepend">
                        <label class="input-group-text todo" for="inputGroupSelect02">02</label>
                      </div>
                      <select class="custom-select" resource="<%=resourceName%>" subresource="<%=subresourceName%>" topic="o_que_fazer" order="2">
                        <option value="" selected>escolha o que fazer</option>
                        <%if(subresources[sindex].o_que_fazer.length>0){
                          var o_que_fazer = subresources[sindex].o_que_fazer;
                          for(j=0;j<o_que_fazer.length;j++){
                            %>
                            <option value='<%=j+1%>'><%=o_que_fazer[j].option%></option>
                            <%
                          }
                        }%>
                      </select>
                    </div>
                  </div><!--row-->
                  <div class="row">
                    <div class="input-group mb-3">
                      <div class="input-group-prepend">
                        <label class="input-group-text todo" for="inputGroupSelect03">03</label>
                      </div>
                      <select class="custom-select" resource="<%=resourceName%>" subresource="<%=subresourceName%>" topic="o_que_fazer" order="3">
                        <option value="" selected>escolha o que fazer</option>
                        <%if(subresources[sindex].o_que_fazer.length>0){
                          var o_que_fazer = subresources[sindex].o_que_fazer;
                          for(j=0;j<o_que_fazer.length;j++){
                            %>
                            <option value='<%=j+1%>'><%=o_que_fazer[j].option%></option>
                            <%
                          }
                        }%>
                      </select>
                    </div>
                  </div><!--row-->
                  <div class='row'>
                    <div class="input-group mb-3">
                      <div class="input-group-prepend">
                        <span class="input-group-text todo" id="basic-addon4">04</span>
                      </div>
                      <input type="text" class="form-control" placeholder="escreva o que fazer" aria-label="o que fazer" aria-describedby="basic-addon1" resource="<%=resourceName%>" subresource="<%=subresourceName%>" topic="o_que_fazer_free" order="1">
                    </div>
                  </div>

                  <div class='row'>
                    <div class="input-group mb-3">
                      <div class="input-group-prepend">
                        <span class="input-group-text todo" id="basic-addon5">05</span>
                      </div>
                      <input type="text" class="form-control" placeholder="escreva o que fazer" aria-label="o que fazer" aria-describedby="basic-addon1" resource="<%=resourceName%>" subresource="<%=subresourceName%>" topic="o_que_fazer_free" order="2">
                    </div>
                  </div>

                  <div class='row'>
                    <div class="input-group mb-3">
                      <div class="input-group-prepend">
                        <span class="input-group-text todo" id="basic-addon6">06</span>
                      </div>
                      <input type="text" class="form-control" placeholder="escreva o que fazer" aria-label="o que fazer" aria-describedby="basic-addon1" resource="<%=resourceName%>" subresource="<%=subresourceName%>" topic="o_que_fazer_free" order="3">
                    </div>
                  </div><!-- row -->
                  <!-- end of h2 what to do -->

                <h2 class="questionaire">Questionário - <%=subresourceName%></h2>

                    <%var questionaire = subresources[sindex].questionaire;

                    for(w=0;w<questionaire.length;w++){%>
                      <div class='row'>
                        <div class="col-1">
                           <span class="input-group-text questionaire-item" id="basic-addon6"><%=questionaire[w].order%></span>
                        </div>
                        <div class="col-8">
                            <span class="input-group-text form-control"><%=questionaire[w].question%></span>
                        </div>
                        <div class="col-3">
                          <div class='form-group'>
                            <select class="form-control" resource="<%=resourceName%>" subresource="<%=subresourceName%>" topic="questionaire" order="<%=questionaire[w].order%>" question="<%=questionaire[w].question%>">
                              <option value="" selected>escolha a nota</option>
                              <option value="1">1</option>
                              <option value="2">2</option>
                              <option value="3">3</option>
                              <option value="4">4</option>
                              <option value="5">5</option>
                              <option value="6">6</option>
                              <option value="7">7</option>
                              <option value="8">8</option>
                              <option value="9">9</option>
                              <option value="10">10</option>
                            </select>
                          </div>
                        </div>
                      </div><!-- row -->
                    <%}%>

                    <%var free_questionaire = subresources[sindex].free_questionaire;

                    for(z=0;z<free_questionaire.length;z++){%>
                      <div class="row">
                        <div class="col-12">
                          <h2 class="questionaire"><%=free_questionaire[z].question%></h2>
                        </div>
                        <div class="col-12">
                          <div class='form-group'>
                            <select class="form-control" id="inputGroupSelect01" resource="<%=resourceName%>" subresource="<%=subresourceName%>" topic="free_questionaire" order="<%=free_questionaire[z].order%>" question="<%=free_questionaire[z].question%>">
                              <option value="" selected>escolha a frequência</option>
                              <%
                                var answers = free_questionaire[z].answers;
                                for(y=0;y<answers.length;y++){
                              %>
                                  <option value="<%=answers[y].order%>"><%=answers[y].answer.toLowerCase()%></option>
                              <%}%>
                            </select>
                          </div><!--class form group-->
                        </div>
                      </div>

                    <%}//for(z=0;z<free_questionaire.length;z++)%>
                    <hr>
              <%
            }//for(sindex=0;sindex<subresources.length;sindex++)%>

            </main>

          <%
          }//for(rindex=0;rindex<resources.length;rindex++)
          %>

        </form><!-- end of resourcesForm -->

        <!----------------------------- END OF <%=target%> WRAP ------------------------------>
        <%
        }//if(target=="home" || target=="time" || target=="knowledge" || target=="health" || target=="emotion" )
        %>

        <%if(target=="recommendationsAdmin"){%>
        <!----------------------------- RECOMMENDATIONS ADMIN WRAP ------------------------------------->
          <main role="main" resource="<%=target%>" class="col-md-9 ml-sm-auto col-lg-10 pt-3 px-4" <%if(!visible){%>style="display:none;"<%}%>>

            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom">
              <h1 class="h2">Administração de Recomendações</h1>
              <div class="btn-toolbar mb-2 mb-md-0">
                <div class="btn-group mr-2">
                  <button class="btn btn-sm btn-outline-secondary">Botão 1</button>
                  <button class="btn btn-sm btn-outline-secondary" data-toggle="modal" data-target="#modal">Botão 2</button>
                </div>
              </div>
            </div>

            <div id="error_message"></div>

            <div class="row" resource="dinheiro">
              <div class="col rounded text-white bg-dark" resource="dinheiro">DINHEIRO</div>
            </div>

            <div class="row" resource="dinheiro" subresource="organização">
              <div class="col rounded text-white bg-success" resource="dinheiro" subresource="organização">ORGANIZAÇÃO</div>
            </div>

          <div class="row" resource="dinheiro" subresource="organização">
            <div class="col rounded border bg-light">título</div>
            <div class="col rounded border bg-light"><a href='link' target='_new'>link</a></div>
          </div>

          </main>
        <!----------------------------- END OF RECOMMENDATIONS ADMIN WRAP ------------------------------>
        <%}%>

      </div>
    </div>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script>
      feather.replace()
    </script>


    <%if(target=="home"){%>
    <script>
      //get completed user questionaires information

      var userResults = [];

      var completeQuestionairesRequest = $.ajax({
            url:'/get_complete_user_questionaires',
            method:'GET',
            dataType: 'json',
      });

      completeQuestionairesRequest.done(function(data){

        if(data.success){

          //prepare array with results
          var questionaires = data.userQuestionaires;
          var resultsTable = [];
          var chartLables = [];
          var chartData = [];

          for(var q=0;q<questionaires.length;q++){

            var questionaire = questionaires[q];
            var questionaireDate = questionaire.update ? questionaire.update : null;

            userResults[q]={questionaireDate:questionaireDate};

            var questionaireNewDate = new Date(questionaireDate);
            var questionaireNewDateString = questionaireNewDate.toLocaleString("pt-BR");;

            resultsTable[q]={};
            resultsTable[q].questionaireDate=questionaireNewDateString;


            chartLables[q]=questionaireNewDateString

            var resources = questionaires[q].resources;
            userResults[q].resources = {};

            var lifeTotals = 0;
            var lifeCount = 0;

            for(var r in resources){

              userResults[q].resources[r]={};
              var subresources = resources[r];

              userResults[q].resources[r].average = 0;
              userResults[q].resources[r].subresources = {};

              var resourceTotals = 0;
              var resourceCount = 0;

              for(var s in subresources){
                //calc average from subresource
                var questionaireTopic = subresources[s].questionaire ? subresources[s].questionaire : {};

                var questionaireTotal = 0;
                var questionaireCount = 0;

                for(qindex=0;qindex<questionaireTopic.length;qindex++){
                  questionaireTotal += +questionaireTopic[qindex].score;
                  questionaireCount ++;
                }

                var free_questionaire = subresources[s].free_questionaire ? subresources[s].free_questionaire : {};

                var free_questionaireTotal = 0;
                var free_questionaireCount = 0;

                for(qindex=0;qindex<free_questionaire.length;qindex++){
                  free_questionaireTotal += (+free_questionaire[qindex].answerOrder)*2;
                  free_questionaireCount ++;
                }

                var subResourceAverage = (questionaireTotal+free_questionaireTotal)/(questionaireCount+free_questionaireCount);

                userResults[q].resources[r].subresources[s]=subResourceAverage;

                resourceTotals += +subResourceAverage;
                resourceCount ++;

              }//for(var s in subresources)

              var resourceAverage = +resourceCount==0 ? 0 : (+resourceTotals/+resourceCount);

              userResults[q].resources[r].average = resourceAverage;

              resultsTable[q][r]=resourceAverage;

              lifeTotals += +resourceAverage;
              lifeCount ++;

            }//for(var r in resources)

            var lifeAverage=lifeCount==0?0:(lifeTotals/lifeCount);
            resultsTable[q].lifeAverage=lifeAverage.toFixed(2);
            chartData[q]=lifeAverage.toFixed(2);

          }for(var q=0;q<questionaires.length;q++)

          //build results table
          var resultsTableMarkup = "";

          for(var t in resultsTable){


            var row = resultsTable[t];
            resultsTableMarkup += '<tr>';

              resultsTableMarkup += '<td>' + resultsTable[t].questionaireDate + '</td>';
              resultsTableMarkup += '<td>' + resultsTable[t].lifeAverage + '</td>';
              resultsTableMarkup += '<td>' + resultsTable[t].dinheiro + '</td>';
              resultsTableMarkup += '<td>' + resultsTable[t].saúde + '</td>';
              resultsTableMarkup += '<td>' + resultsTable[t].conhecimento + '</td>';
              resultsTableMarkup += '<td>' + resultsTable[t].tempo + '</td>';
              resultsTableMarkup += '<td>' + resultsTable[t].emoção + '</td>';

            resultsTableMarkup += '</tr>';

          }//for(var t in resultsTable)
          $("#resultsTable tbody").html(resultsTableMarkup);


          var ctx = document.getElementById("myChart");
          var myChart = new Chart(ctx, {
            type: 'line',
            data: {
              labels: chartLables,
              datasets: [{
                data: chartData,
                lineTension: 0,
                backgroundColor: 'transparent',
                borderColor: '#007bff',
                borderWidth: 4,
                pointBackgroundColor: '#007bff'
              }]
            },
            options: {
              scales: {
                yAxes: [{
                  ticks: {
                    beginAtZero: false
                  }
                }]
              },
              legend: {
                display: false,
              }
            }
          });



        }//if(data.success)


        if(!data.success){
          console.log("questionaires couldn't be retreived!");
        }





      });//completeQuestionairesRequest.done(function(data)

      </script>

    <!-- Graphs -->
    <script>

    </script>
    <%}%>

    <!-- main script -->
    <%if( target=="money" || target=="time" || target=="knowledge" || target=="health" || target=="emotion" ){%>
    <script>
      $(document).ready(function(){



        var userQuestionaires = {};
        var incompleteUserQuestionaire = {};
        var data={target_back_url:"<%=target%>"};

        //retrieve incomplete questionaire from this user
        //ajax request to GET_USER_QUESTIONAIRES
        var incompleteUserQuestionaireRequest = $.ajax({
            url:'/get_incomplete_user_questionaire',
            method:'GET',
            dataType: 'json',
            data:data

        });

          incompleteUserQuestionaireRequest.done(function(data){
            if(data.success){
              /*procedures to fill in object incompleteUserQuestionaire*/
              var userQuestionaire = data.userQuestionaire;
              if(userQuestionaire.length!==0){
                var resources = userQuestionaire[0].resources;
                for(var r in resources){
                  var resourceName = r.toLowerCase();
                  incompleteUserQuestionaire[resourceName]={};
                  var subresources = resources[r];
                  for(var s in subresources){
                    var subresourceName = s.toLowerCase();
                    incompleteUserQuestionaire[resourceName][subresourceName]={};
                    /////o_que_evitar
                    var o_que_evitar = subresources[s].o_que_evitar ? subresources[s].o_que_evitar : [];
                    incompleteUserQuestionaire[resourceName][subresourceName].o_que_evitar=[];
                    for(o=0;o<o_que_evitar.length;o++){
                      var option = o_que_evitar[o].option;
                      var order = o_que_evitar[o].order;
                      incompleteUserQuestionaire[resourceName][subresourceName].o_que_evitar[o]={option:option,order:order};
                      //fill in compatible selects
                      var position = o+1;
                      $("select[resource='"+resourceName+"'][subresource='"+subresourceName+"'][topic='o_que_evitar'][order='"+position+"'").val(order);
                    }//for(o=0;o<o_que_evitar.length;o++)
                    ////o_que_fazer
                    var o_que_fazer = subresources[s].o_que_fazer ? subresources[s].o_que_fazer : [];
                    incompleteUserQuestionaire[resourceName][subresourceName].o_que_fazer=[];
                    for(o=0;o<o_que_fazer.length;o++){
                      var option = o_que_fazer[o].option;
                      var order = o_que_fazer[o].order;
                      incompleteUserQuestionaire[resourceName][subresourceName].o_que_fazer[o]={option:option,order:order};
                      //fill in compatible selects
                      var position = o+1;
                      $("select[resource='"+resourceName+"'][subresource='"+subresourceName+"'][topic='o_que_fazer'][order='"+position+"'").val(order);
                    }//for(o=0;o<o_que_fazer.length;o++)
                    ////o_que_evitar_free
                    var o_que_evitar_free = subresources[s].o_que_evitar_free ? subresources[s].o_que_evitar_free : [];
                    incompleteUserQuestionaire[resourceName][subresourceName].o_que_evitar_free=[];
                    for(o=0;o<o_que_evitar_free.length;o++){
                      var option = o_que_evitar_free[o].option;
                      var order = o_que_evitar_free[o].order;
                      incompleteUserQuestionaire[resourceName][subresourceName].o_que_evitar_free[o]={option:option,order:order};
                      //fill in compatible selects
                      var position=o+1;
                      $("input[resource='"+resourceName+"'][subresource='"+subresourceName+"'][topic='o_que_evitar_free'][order='"+position+"'").val(option);
                    }//for(o=0;o<o_que_evitar_free.length;o++)
                    ////o_que_fazer_free
                    var o_que_fazer_free = subresources[s].o_que_fazer_free ? subresources[s].o_que_fazer_free : [];
                    incompleteUserQuestionaire[resourceName][subresourceName].o_que_fazer_free=[];
                    for(o=0;o<o_que_fazer_free.length;o++){
                      var option = o_que_fazer_free[o].option;
                      var order = o_que_fazer_free[o].order;
                      incompleteUserQuestionaire[resourceName][subresourceName].o_que_fazer_free[o]={option:option,order:order};
                       //fill in compatible selects
                       var position = o+1;
                      $("input[resource='"+resourceName+"'][subresource='"+subresourceName+"'][topic='o_que_fazer_free'][order='"+position+"'").val(option);
                    }//for(o=0;o<o_que_fazer_free.length;o++)
                    ////questionaire
                    var questionaire = subresources[s].questionaire ? subresources[s].questionaire : [];
                    incompleteUserQuestionaire[resourceName][subresourceName].questionaire=[];
                    for(o=0;o<questionaire.length;o++){
                      var question = questionaire[o].question;
                      var order = questionaire[o].order;
                      var score = questionaire[o].score;
                      incompleteUserQuestionaire[resourceName][subresourceName].questionaire[o]={question:question,order:order,score:score};
                       //fill in compatible selects
                      var position = o+1;
                      $("select[resource='"+resourceName+"'][subresource='"+subresourceName+"'][topic='questionaire'][order='"+position+"'").val(score);
                    }//for(o=0;o<questionaire.length;o++)
                    ////questionaire
                    var free_questionaire = subresources[s].free_questionaire ? subresources[s].free_questionaire : [];
                    incompleteUserQuestionaire[resourceName][subresourceName].free_questionaire=[];
                    for(o=0;o<free_questionaire.length;o++){
                      var question = free_questionaire[o].question;
                      var order = free_questionaire[o].order;
                      var answerOrder = free_questionaire[o].answerOrder;
                      var answerText = free_questionaire[o].answerText;
                      incompleteUserQuestionaire[resourceName][subresourceName].free_questionaire[o]={question:question,order:order,answerOrder:answerOrder,answerText:answerText};
                      //fill in compatible selects
                      var position = o+1;
                      $("select[resource='"+resourceName+"'][subresource='"+subresourceName+"'][topic='free_questionaire'][order='"+position+"'").val(answerOrder);
                    }//for(o=0;o<free_questionaire.length;o++)

                  }//for(s=0;s<subresources.length;s++)
                }//for(r=0;r<resources.length;r++)



              }//if(userQuestionaire.length!==0)

              updateCompletePercentage();

              $("[role='main']").on("change","select,input",function(event){
                event.stopPropagation();
                event.preventDefault();
                var resource = $(this).attr("resource");
                var subresource = $(this).attr("subresource");
                var topic = $(this).attr("topic");
                var order = $(this).attr("order") - 1;
                updateCompletePercentage();
                //var incompleteUserQuestionaire = {};
                if(! incompleteUserQuestionaire[resource]){
                   incompleteUserQuestionaire[resource]={};
                };
                if(! incompleteUserQuestionaire[resource][subresource]){
                   incompleteUserQuestionaire[resource][subresource]={};
                };
                if(! incompleteUserQuestionaire[resource][subresource][topic]){
                   incompleteUserQuestionaire[resource][subresource][topic]= []
                } ;
                if(topic=="o_que_evitar" || topic=="o_que_fazer"){
                  //TODO: check if there is other option with the same selection
                   incompleteUserQuestionaire[resource][subresource][topic][order] = {option:$(this).find("option:selected").text(),order:$(this).val()};

                }
                if(topic=="o_que_evitar_free" || topic=="o_que_fazer_free"){
                  //TODO: check if there is other option with the same selection
                  incompleteUserQuestionaire[resource][subresource][topic][order] = {option:$(this).val(),order:order};
                }//if(topic=="o_que_evitar_free" || topic=="o_que_fazer_free")
                if(topic=="questionaire"){
                  //TODO: check if there is other option with the same selection
                   incompleteUserQuestionaire[resource][subresource][topic][order] = {order:order,question:$(this).attr("question"),score:$(this).val()};
                }//if(topic=="questionaire" || topic=="questionaire")
                if(topic=="free_questionaire"){
                  //TODO: check if there is other option with the same selection
                  incompleteUserQuestionaire[resource][subresource][topic][order] = {
                      answerOrder:$(this).val(),
                      answerText:$(this).find("option:selected").text(),
                      order:order,
                      question:$(this).attr("question")
                  };

                }//if(topic=="questionaire" || topic=="questionaire")
                //save incomplete updated questionaire
                $("select,input").each(function(){
                  $(this).attr("disabled",true);
                });

                $("#questionaireSaveStatusSaving").show();

                var saveIncompleteUserQuestionaireRequest = $.ajax({
                  url:'/save_incomplete_user_questionaire',
                  method:'POST',
                  dataType: 'json',
                  data:incompleteUserQuestionaire,
                  complete:function(xmlrequest,status){
                              console.log("xmlrequest:");
                              console.log(xmlrequest);
                              console.log("status:"+status);
                              if(status!='success'){
                                $("#questionaireSaveStatusSaving").hide();
                                $("#questionaireSaveStatusProblem").show().delay(1000).fadeOut(2000,function(){
                                  $("#questionaireSaveStatusProblem").hide();
                                })
                              }
                          }
                });//var incompleteUserQuestionaireRequest = $.ajax(

                saveIncompleteUserQuestionaireRequest.done(function(data){

                   $("select,input").each(function(){
                      $(this).removeAttr("disabled");
                    });

                   console.log("chegou no done");

                  if(!data.success || !data || data=={}){
                    console.log("incompleteUserQuestionaire was not saved correctly. Follow error message:" + data.errorMessage);
                    $("#questionaireSaveStatusSaving").hide();
                    $("#questionaireSaveStatusProblem").show().delay(1000).fadeOut(2000,function(){
                      $("#questionaireSaveStatusProblem").hide();
                    });
                    return;
                  }

                  console.log("incompleteUserQuestionaire was saved correctly. Follow message:" + data.message);
                  $("#questionaireSaveStatusSaving").hide();
                  $("#questionaireSaveStatusSuccess").show().delay(1000).fadeOut(2000,function(){
                    $("#questionaireSaveStatusSuccess").hide();
                  });

                });//saveIncompleteUserQuestionaireRequest.done(function(data)

              });//$("[role='main']").on("change","select,input",function(event)


            } else {
              $(".container-fluid").prepend(
                '<div class="alert alert-danger" id="requestError">' +
                  '<strong>Atenção! Questionário não carregado. Erro na requisição</strong>' +
                '</div>'
                );
              $("#requestError").delay(2000).fadeOut('slow', function(){$(this).remove()});
            }

          });//incompleteUserQuestionaireRequest.done(function(data)




        //save complete questionaire
        $("button#saveCompleteQuestionaire").on("click", function(event){
          event.stopPropagation();
          event.preventDefault();

          var errorMarkup = "";

          //check if everything needed is chosen
          var unchosenFields = 0;

          //test money resource filling

          var resourcesList={
            'dinheiro':['organização','dívidas','receita/plano b','investimento'],
            'saúde':['gestão da saúde','alimentação','exercício físico','sono e respiração'],
            'conhecimento':['organização do aprendizado', 'tomada de decisão', 'heurística/sabedoria', 'carreira - plano b'],
            'tempo':['organização do tempo', 'produtividade', 'presença', 'relatividade'],
            'emoção':['organização das emoções', 'descoberta', 'relacionamento', 'egoísmo/altruísmo']
          };
          for(var rl in resourcesList){
            var subresourcesList = resourcesList[rl];
            var resourceName = rl;
            for(var subr in subresourcesList){
              var subresourceName = subresourcesList[subr];

              var topicFieldsFilled = 0;
              $("#resourcesForm").find("select[resource='"+rl+"'][subresource='"+subresourceName+"'][topic='o_que_evitar']").each(function(){
                  if($(this).val()!='') topicFieldsFilled ++;
                });
              if(topicFieldsFilled<1) {
                unchosenFields ++;
                errorMarkup += "Há menos de um campo preenchido (quantidade de preenchimentos: "+topicFieldsFilled+") para o que evitar no subrecurso " + subresourceName + " no recurso " + rl + "<br>";
              }
              var topicFieldsFilled = 0;
              $("#resourcesForm").find("input[resource='"+rl+"'][subresource='"+subresourceName+"'][topic='o_que_evitar_free']").each(function(){
                  if($(this).val()!='') topicFieldsFilled ++;
              });
              if(topicFieldsFilled<1) {
                unchosenFields ++;
                errorMarkup += "Há menos de um campo preenchido para o que evitar (livre) subrecurso " + subresourceName + " no recurso " + rl + "<br>";
              }

              var topicFieldsFilled = 0;
              $("#resourcesForm").find("select[resource='"+rl+"'][subresource='"+subresourceName+"'][topic='o_que_fazer']").each(function(){
                  if($(this).val()!='') topicFieldsFilled ++;
              });
              if(topicFieldsFilled<1) {
                unchosenFields ++;
                errorMarkup += "Há menos de um campo preenchido para o que fazer no subrecurso " + subresourceName + " no recurso " + rl + "<br>";
              }
              var topicFieldsFilled = 0;
              $("#resourcesForm").find("input[resource='"+rl+"'][subresource='"+subresourceName+"'][topic='o_que_fazer_free']").each(function(){
                  if($(this).val()!='') topicFieldsFilled ++;
              });
              if(topicFieldsFilled<1) {
                unchosenFields ++;
                errorMarkup += "Há menos de um campo preenchido para o que fazer (livre) subrecurso " + subresourceName + " no recurso " + rl + "<br>";
              }

              $("#resourcesForm").find("select[resource='"+rl+"'][subresource='"+subresourceName+"'][topic='questionaire']").each(function(){
                  if($(this).val()=='') {
                    unchosenFields ++;
                    errorMarkup += "Os campos não estão completamente preenchidos para o questionário no subrecurso " + subresourceName + " no recurso " + rl + "<br>";
                  }

              });

              $("#resourcesForm").find("select[resource='"+rl+"'][subresource='"+subresourceName+"'][topic='free_questionaire']").each(function(){
                  if($(this).val()=='') {
                    unchosenFields ++;
                    errorMarkup += "Os campos não estão completamente preenchidos para o questionário de intensidade no subrecurso " + subresourceName + " no recurso " + rl + "<br>";

                  }
              });


            }
          }

          if(unchosenFields!==0){
            $("#modalCannotSaveQuestionaire .modal-body").html(errorMarkup);
            $("#modalCannotSaveQuestionaire").modal();
            return;
          } else {
            var saveCompleteUserQuestionaire = $.ajax({
                  url:'/save_complete_user_questionaire',
                  method:'POST',
                  dataType: 'json',
                  data:incompleteUserQuestionaire
            });//var saveCompleteUserQuestionaire = $.ajax(

            saveCompleteUserQuestionaire.done(function(data){
              if(!data.success){
                $("#modalSaveUserQuestionaireError").modal();
              } else {
                $("#modalSaveUserQuestionaireConfirmation").modal();
                $("#resourcesForm").find("input,select").each(function(){
                  $(this).val("");
                  updateCompletePercentage();
                  incompleteUserQuestionaire = {};
                });
              }
            });

            return;
          }

        });//$("button#saveCompleteQuestionaire").on("click", function(event)


      });//$(document).ready(function()


      function updateCompletePercentage(){
        //global
        var unchosenFields = 0;
        var totalFields = $("#resourcesForm").find("input[resource],select[resource]").length;
        $("#resourcesForm").find("input,select").each(function(){
            //totalFields ++;
            if($(this).val()=="") unchosenFields ++;
        });
        var buttonText = "";
        var percentage = ((+totalFields-+unchosenFields)/+totalFields)*100;
        if(percentage==100){
          buttonText = "Gravar questionário completo";
        } else {
          buttonText = "Questionário " + (((+totalFields-+unchosenFields)/+totalFields)*100).toFixed(2) + "% completo";
        }
        $("button#saveCompleteQuestionaire").text(buttonText);

        //money
        var unchosenFields = 0;
        var totalFields = 0;
        $("#resourcesForm").find("input[resource='dinheiro'],select[resource='dinheiro']").each(function(){
            totalFields ++;
            if($(this).val()=="") unchosenFields ++;
        });
        var buttonText = "";
        var percentage = ((+totalFields-+unchosenFields)/+totalFields)*100;

        spanText = (((+totalFields-+unchosenFields)/+totalFields)*100).toFixed(2) + "%";

        $(".moneyPercentual").text(spanText);

        //time
        var unchosenFields = 0;
        var totalFields = 0;
        $("#resourcesForm").find("input[resource='tempo'],select[resource='tempo']").each(function(){
            totalFields ++;
            if($(this).val()=="") unchosenFields ++;
        });
        var buttonText = "";
        var percentage = ((+totalFields-+unchosenFields)/+totalFields)*100;

        spanText = (((+totalFields-+unchosenFields)/+totalFields)*100).toFixed(2) + "%";

        $(".timePercentual").text(spanText);

         //knowledge
        var unchosenFields = 0;
        var totalFields = 0;
        $("#resourcesForm").find("input[resource='conhecimento'],select[resource='conhecimento']").each(function(){
            totalFields ++;
            if($(this).val()=="") unchosenFields ++;
        });
        var buttonText = "";
        var percentage = ((+totalFields-+unchosenFields)/+totalFields)*100;

        spanText = (((+totalFields-+unchosenFields)/+totalFields)*100).toFixed(2) + "%";

        $(".knowledgePercentual").text(spanText);

         //health
        var unchosenFields = 0;
        var totalFields = 0;
        $("#resourcesForm").find("input[resource='saúde'],select[resource='saúde']").each(function(){
            totalFields ++;
            if($(this).val()=="") unchosenFields ++;
        });
        var buttonText = "";
        var percentage = ((+totalFields-+unchosenFields)/+totalFields)*100;

        spanText = (((+totalFields-+unchosenFields)/+totalFields)*100).toFixed(2) + "%";

        $(".healthPercentual").text(spanText);

         //emotion
        var unchosenFields = 0;
        var totalFields = 0;
        $("#resourcesForm").find("input[resource='emoção'],select[resource='emoção']").each(function(){
            totalFields ++;
            if($(this).val()=="") unchosenFields ++;
        });
        var buttonText = "";
        var percentage = ((+totalFields-+unchosenFields)/+totalFields)*100;

        spanText = (((+totalFields-+unchosenFields)/+totalFields)*100).toFixed(2) + "%";

        $(".emotionPercentual").text(spanText);

      }



    </script>
    <%}%>

    <script>
      $("a#buttonLogout").on("click",function(event){
          event.preventDefault();
          event.stopPropagation();
          $("#modalLogoutConfirmation").modal();
        });

        $("button#closeSession").on("click",function(event){
          event.preventDefault();
          event.stopPropagation();
          window.location.href='/logout';
        });
    </script>



  </body>

</html>
